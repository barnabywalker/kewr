<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ToL • kewr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ToL">
<meta property="og:description" content="kewr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kewr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/IPNI.html">IPNI</a>
    </li>
    <li>
      <a href="../articles/KNMS.html">KNMS</a>
    </li>
    <li>
      <a href="../articles/POWO.html">POWO</a>
    </li>
    <li>
      <a href="../articles/ToL.html">ToL</a>
    </li>
    <li>
      <a href="../articles/WCVP.html">WCVP</a>
    </li>
    <li>
      <a href="../articles/articles/building-checklist.html">Building a species checklist</a>
    </li>
    <li>
      <a href="../articles/articles/conservation-status-treeoflife.html">Putting conservation status on the Tree of Life</a>
    </li>
    <li>
      <a href="../articles/articles/mapping-assessed-species.html">Mapping assessed species</a>
    </li>
    <li>
      <a href="../articles/articles/retrieve-all-query-results.html">Retrieving all results for a query</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/barnabywalker/kewr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ToL_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ToL</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/barnabywalker/kewr/blob/master/vignettes/ToL.Rmd"><code>vignettes/ToL.Rmd</code></a></small>
      <div class="hidden name"><code>ToL.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://barnabywalker.github.io/kewr/">kewr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></code></pre></div>
<p>The <a href="https://treeoflife.kew.org/">Tree of Life</a> is a database of specimens sequenced as part of Kew’s efforts to build a comprehensive evolutionary tree of life for flowering plants.</p>
<p>This package accesses data from the Tree of Life Explorer, an output of the Plant and Fungal Trees of Life Project (PAFTOL). The data in the Tree of Life is generated by target sequence capture using the universal Angiosperm353 probe set.</p>
<p>The Tree of Life contains information about specimens that have been sequenced and genes recovered in the process. It lets you download sequence data for the specimens, as well as alignments and trees for the genes.</p>
<div id="viewing-the-tree-of-life" class="section level2">
<h2 class="hasAnchor">
<a href="#viewing-the-tree-of-life" class="anchor"></a>Viewing the Tree of Life</h2>
<p>The <a href="https://treeoflife.kew.org/tree-of-life">Tree of Life Explorer</a> lets users view the tree of life constructed from the current dataset of samples.</p>
<p>You can view it using <code>kewr</code> by loading it in:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_tol.html">load_tol</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="va">tree</span>
<span class="co">#&gt; &lt;ToL tree url: https://treeoflife.kew.org/api/tree&gt;</span>
<span class="co">#&gt; Preview:</span>
<span class="co">#&gt; (((17419_false_Gnetales_Gnetaceae_Gnetum_montanum:0.00000,18215_false_Ephedrales_Ephedraceae_Ephedra</span></code></pre></div>
<p>This reads it as a single string, so you need to use other packages to parse it and view it (e.g, <a href="http://ape-package.ird.fr/">ape</a>).</p>
</div>
<div id="searching-tol-for-specimens" class="section level2">
<h2 class="hasAnchor">
<a href="#searching-tol-for-specimens" class="anchor"></a>Searching ToL for specimens</h2>
<p>The Tree of Life contains information about the specimens that have been sequenced to construct the tree. The long-term aim is to sample at least on species from every flowering plant genus. This means that, typically, there will be one specimen per species.</p>
<p>You can search this information using the <code>search_tol</code> function. There is no filtering or keyword-search functionality, so queries are just the name of an order/family/genus/species. For example, to get all specimens for the genus <em>Myrcia</em>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">specimens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_tol.html">search_tol</a></span><span class="op">(</span><span class="st">"Myrcia"</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="va">specimens</span>
<span class="co">#&gt; &lt;ToL search: 'Myrcia'&gt;</span>
<span class="co">#&gt; total results: 17</span>
<span class="co">#&gt; returned results: 17</span>
<span class="co">#&gt; total pages: 1</span>
<span class="co">#&gt; current page: 1</span>
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ :List of 20</span>
<span class="co">#&gt;   ..$ age                    : NULL</span>
<span class="co">#&gt;   ..$ collector              : chr "Lima, D. F."</span>
<span class="co">#&gt;   ..$ collector_no           : chr "504"</span>
<span class="co">#&gt;   ..$ country                : NULL</span>
<span class="co">#&gt;   ..$ fasta_file_url         : chr "http://sftp.kew.org/pub/paftol/current_release/fasta/by_recovery/INSDC.ERR5034774.Myrcia_albotomentosa.a353.fasta"</span>
<span class="co">#&gt;   ..$ gene_stats             :List of 2</span>
<span class="co">#&gt;   ..$ genus                  :List of 3</span>
<span class="co">#&gt;   ..$ herbcat_url            : NULL</span>
<span class="co">#&gt;   ..$ id                     : int 2717</span>
<span class="co">#&gt;   ..$ is_suspicious_placement: logi FALSE</span>
<span class="co">#&gt;   ..$ material_source        :List of 2</span>
<span class="co">#&gt;   ..$ museum_barcode         : NULL</span>
<span class="co">#&gt;   ..$ project                :List of 2</span>
<span class="co">#&gt;   ..$ raw_reads              :List of 1</span>
<span class="co">#&gt;   ..$ sequence_id            : int 5528</span>
<span class="co">#&gt;   ..$ species                :List of 2</span>
<span class="co">#&gt;   ..$ specimen_reference     : chr "Lima, D. F. 504 (K)"</span>
<span class="co">#&gt;   ..$ specimen_source        : chr "RBGKew DNA Bank"</span>
<span class="co">#&gt;   ..$ taxonomy               :List of 4</span>
<span class="co">#&gt;   ..$ voucher_no             : NULL</span></code></pre></div>
<p>This searching works by exact matching, and the taxonomy follows <a href="https://wcvp.science.kew.org/">WCVP</a> so only accepted names will work. For example, if we mispell <em>Myrcia</em> we get nothing:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/search_tol.html">search_tol</a></span><span class="op">(</span><span class="st">"Mercya"</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="co">#&gt; &lt;ToL search: 'Mercya'&gt;</span>
<span class="co">#&gt; total results: 0</span>
<span class="co">#&gt; returned results: 0</span>
<span class="co">#&gt; total pages: 0</span>
<span class="co">#&gt; current page: 1</span>
<span class="co">#&gt;  list()</span></code></pre></div>
<p>And if we search for an outdated synonym we get nothing:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/search_tol.html">search_tol</a></span><span class="op">(</span><span class="st">"Gomidesia"</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="co">#&gt; &lt;ToL search: 'Gomidesia'&gt;</span>
<span class="co">#&gt; total results: 0</span>
<span class="co">#&gt; returned results: 0</span>
<span class="co">#&gt; total pages: 0</span>
<span class="co">#&gt; current page: 1</span>
<span class="co">#&gt;  list()</span></code></pre></div>
<p>But search using higher taxonomy will work:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">specimens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_tol.html">search_tol</a></span><span class="op">(</span><span class="st">"Myrtaceae"</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="va">specimens</span>
<span class="co">#&gt; &lt;ToL search: 'Myrtaceae'&gt;</span>
<span class="co">#&gt; total results: 171</span>
<span class="co">#&gt; returned results: 50</span>
<span class="co">#&gt; total pages: 4</span>
<span class="co">#&gt; current page: 1</span>
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ :List of 20</span>
<span class="co">#&gt;   ..$ age                    : int 1996</span>
<span class="co">#&gt;   ..$ collector              : chr "Chase, M.W."</span>
<span class="co">#&gt;   ..$ collector_no           : chr "10349"</span>
<span class="co">#&gt;   ..$ country                : NULL</span>
<span class="co">#&gt;   ..$ fasta_file_url         : chr "http://sftp.kew.org/pub/paftol/current_release/fasta/by_recovery/INSDC.ERR5033686.Acca_sellowiana.a353.fasta"</span>
<span class="co">#&gt;   ..$ gene_stats             :List of 2</span>
<span class="co">#&gt;   ..$ genus                  :List of 3</span>
<span class="co">#&gt;   ..$ herbcat_url            : NULL</span>
<span class="co">#&gt;   ..$ id                     : int 2660</span>
<span class="co">#&gt;   ..$ is_suspicious_placement: logi FALSE</span>
<span class="co">#&gt;   ..$ material_source        :List of 2</span>
<span class="co">#&gt;   ..$ museum_barcode         : NULL</span>
<span class="co">#&gt;   ..$ project                :List of 2</span>
<span class="co">#&gt;   ..$ raw_reads              :List of 1</span>
<span class="co">#&gt;   ..$ sequence_id            : int 5471</span>
<span class="co">#&gt;   ..$ species                :List of 2</span>
<span class="co">#&gt;   ..$ specimen_reference     : chr "Chase, M.W. 10349 (K)"</span>
<span class="co">#&gt;   ..$ specimen_source        : chr "RBGKew DNA Bank"</span>
<span class="co">#&gt;   ..$ taxonomy               :List of 4</span>
<span class="co">#&gt;   ..$ voucher_no             : NULL</span></code></pre></div>
<p>To get all these results, we can either increase the limit in the search function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myrts_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_tol.html">search_tol</a></span><span class="op">(</span><span class="st">"Myrtaceae"</span>, limit<span class="op">=</span><span class="fl">500</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="va">myrts_all</span>
<span class="co">#&gt; &lt;ToL search: 'Myrtaceae'&gt;</span>
<span class="co">#&gt; total results: 171</span>
<span class="co">#&gt; returned results: 171</span>
<span class="co">#&gt; total pages: 1</span>
<span class="co">#&gt; current page: 1</span>
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ :List of 20</span>
<span class="co">#&gt;   ..$ age                    : int 1996</span>
<span class="co">#&gt;   ..$ collector              : chr "Chase, M.W."</span>
<span class="co">#&gt;   ..$ collector_no           : chr "10349"</span>
<span class="co">#&gt;   ..$ country                : NULL</span>
<span class="co">#&gt;   ..$ fasta_file_url         : chr "http://sftp.kew.org/pub/paftol/current_release/fasta/by_recovery/INSDC.ERR5033686.Acca_sellowiana.a353.fasta"</span>
<span class="co">#&gt;   ..$ gene_stats             :List of 2</span>
<span class="co">#&gt;   ..$ genus                  :List of 3</span>
<span class="co">#&gt;   ..$ herbcat_url            : NULL</span>
<span class="co">#&gt;   ..$ id                     : int 2660</span>
<span class="co">#&gt;   ..$ is_suspicious_placement: logi FALSE</span>
<span class="co">#&gt;   ..$ material_source        :List of 2</span>
<span class="co">#&gt;   ..$ museum_barcode         : NULL</span>
<span class="co">#&gt;   ..$ project                :List of 2</span>
<span class="co">#&gt;   ..$ raw_reads              :List of 1</span>
<span class="co">#&gt;   ..$ sequence_id            : int 5471</span>
<span class="co">#&gt;   ..$ species                :List of 2</span>
<span class="co">#&gt;   ..$ specimen_reference     : chr "Chase, M.W. 10349 (K)"</span>
<span class="co">#&gt;   ..$ specimen_source        : chr "RBGKew DNA Bank"</span>
<span class="co">#&gt;   ..$ taxonomy               :List of 4</span>
<span class="co">#&gt;   ..$ voucher_no             : NULL</span></code></pre></div>
<p>Or do paged searching:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">myrts1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_tol.html">search_tol</a></span><span class="op">(</span><span class="st">"Myrtaceae"</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="va">myrts2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/request_next.html">request_next</a></span><span class="op">(</span><span class="va">myrts1</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="va">myrts2</span>
<span class="co">#&gt; &lt;ToL search: 'Myrtaceae'&gt;</span>
<span class="co">#&gt; total results: 171</span>
<span class="co">#&gt; returned results: 50</span>
<span class="co">#&gt; total pages: 4</span>
<span class="co">#&gt; current page: 2</span>
<span class="co">#&gt; List of 1</span>
<span class="co">#&gt;  $ :List of 20</span>
<span class="co">#&gt;   ..$ age                    : NULL</span>
<span class="co">#&gt;   ..$ collector              : chr "J.E.Q. Faria"</span>
<span class="co">#&gt;   ..$ collector_no           : chr "1250"</span>
<span class="co">#&gt;   ..$ country                : NULL</span>
<span class="co">#&gt;   ..$ fasta_file_url         : chr "http://sftp.kew.org/pub/paftol/current_release/fasta/by_recovery/INSDC.ERR5034263.Eugenia_bimarginata.a353.fasta"</span>
<span class="co">#&gt;   ..$ gene_stats             :List of 2</span>
<span class="co">#&gt;   ..$ genus                  :List of 3</span>
<span class="co">#&gt;   ..$ herbcat_url            : NULL</span>
<span class="co">#&gt;   ..$ id                     : int 8160</span>
<span class="co">#&gt;   ..$ is_suspicious_placement: logi FALSE</span>
<span class="co">#&gt;   ..$ material_source        :List of 2</span>
<span class="co">#&gt;   ..$ museum_barcode         : NULL</span>
<span class="co">#&gt;   ..$ project                :List of 2</span>
<span class="co">#&gt;   ..$ raw_reads              :List of 1</span>
<span class="co">#&gt;   ..$ sequence_id            : int 7470</span>
<span class="co">#&gt;   ..$ species                :List of 2</span>
<span class="co">#&gt;   ..$ specimen_reference     : chr "J.E.Q. Faria 1250 (UB)"</span>
<span class="co">#&gt;   ..$ specimen_source        : chr "RBGKew DNA Bank"</span>
<span class="co">#&gt;   ..$ taxonomy               :List of 4</span>
<span class="co">#&gt;   ..$ voucher_no             : NULL</span></code></pre></div>
<p>And we can tidy our results into a dataframe:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidied</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">myrts_all</span><span class="op">)</span>
<span class="va">tidied</span>
<span class="co">#&gt; # A tibble: 171 × 20</span>
<span class="co">#&gt;      age collector     collector_no country  fasta_file_url     gene_stats genus</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;        &lt;list&gt;   &lt;chr&gt;              &lt;list&gt;     &lt;lis&gt;</span>
<span class="co">#&gt;  1  1996 Chase, M.W.   10349        &lt;NULL&gt;   http://sftp.kew.o… &lt;tibble [… &lt;tib…</span>
<span class="co">#&gt;  2  1981 Hensold, N.;… 20845        &lt;tibble… http://sftp.kew.o… &lt;tibble [… &lt;tib…</span>
<span class="co">#&gt;  3  1985 Rodd, A.N.; … 4984         &lt;NULL&gt;   http://sftp.kew.o… &lt;tibble [… &lt;tib…</span>
<span class="co">#&gt;  4  2017 Maurin, O.    4360         &lt;NULL&gt;   http://sftp.kew.o… &lt;tibble [… &lt;tib…</span>
<span class="co">#&gt;  5  2008 J.U.          404          &lt;NULL&gt;   http://sftp.kew.o… &lt;tibble [… &lt;tib…</span>
<span class="co">#&gt;  6  1985 Clark, M.     52           &lt;NULL&gt;   http://sftp.kew.o… &lt;tibble [… &lt;tib…</span>
<span class="co">#&gt;  7  2011 Smith, R.J.,… 294          &lt;NULL&gt;   http://sftp.kew.o… &lt;tibble [… &lt;tib…</span>
<span class="co">#&gt;  8    NA Landrum, L.R. 12251        &lt;NULL&gt;   http://sftp.kew.o… &lt;tibble [… &lt;tib…</span>
<span class="co">#&gt;  9    NA &lt;NA&gt;          &lt;NA&gt;         &lt;NULL&gt;   http://sftp.kew.o… &lt;tibble [… &lt;tib…</span>
<span class="co">#&gt; 10  2005 Johnstone, R. 1544         &lt;NULL&gt;   http://sftp.kew.o… &lt;tibble [… &lt;tib…</span>
<span class="co">#&gt; # … with 161 more rows, and 13 more variables: herbcat_url &lt;chr&gt;, id &lt;int&gt;,</span>
<span class="co">#&gt; #   is_suspicious_placement &lt;lgl&gt;, material_source &lt;list&gt;,</span>
<span class="co">#&gt; #   museum_barcode &lt;chr&gt;, project &lt;list&gt;, raw_reads &lt;list&gt;, sequence_id &lt;int&gt;,</span>
<span class="co">#&gt; #   species &lt;list&gt;, specimen_reference &lt;chr&gt;, specimen_source &lt;chr&gt;,</span>
<span class="co">#&gt; #   taxonomy &lt;list&gt;, voucher_no &lt;chr&gt;</span></code></pre></div>
<p>Some information is nested inside the tidied dataframe, but we can get to it by unnesting:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidied</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">raw_reads</span>, <span class="va">taxonomy</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">taxonomy</span>, <span class="va">raw_reads</span><span class="op">)</span>, names_sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 171 × 10</span>
<span class="co">#&gt;       id raw_reads_data_access_id raw_reads_data_… raw_reads_id raw_reads_reads…</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;                    &lt;chr&gt;                   &lt;int&gt;            &lt;int&gt;</span>
<span class="co">#&gt;  1  2660 ERX4840033               https://www.ebi…         1102          2218140</span>
<span class="co">#&gt;  2  4278 ERX4840494               https://www.ebi…         1760          1363846</span>
<span class="co">#&gt;  3  4221 ERX4840466               https://www.ebi…         1708           911144</span>
<span class="co">#&gt;  4  1610 ERX4890378               https://www.ebi…          567          3707086</span>
<span class="co">#&gt;  5  2692 ERX4840052               https://www.ebi…         1124          2090550</span>
<span class="co">#&gt;  6  4222 ERX4840467               https://www.ebi…         1709          2914784</span>
<span class="co">#&gt;  7  2707 ERX4841120               https://www.ebi…         1136          1819906</span>
<span class="co">#&gt;  8  4591 ERX4841264               https://www.ebi…         1809          1932262</span>
<span class="co">#&gt;  9  2682 ERX4840048               https://www.ebi…         1119          1047180</span>
<span class="co">#&gt; 10  4224 ERX4840468               https://www.ebi…         1710          1044822</span>
<span class="co">#&gt; # … with 161 more rows, and 5 more variables:</span>
<span class="co">#&gt; #   raw_reads_sequence_platform &lt;chr&gt;, taxonomy_family &lt;chr&gt;,</span>
<span class="co">#&gt; #   taxonomy_genus &lt;chr&gt;, taxonomy_order &lt;chr&gt;, taxonomy_species &lt;chr&gt;</span></code></pre></div>
</div>
<div id="getting-gene-information" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-gene-information" class="anchor"></a>Getting gene information</h2>
<p>The Tree of Life also contains information about the genes captured during sequencing. These can be accessed using the <code>search_tol</code> function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">genes_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/search_tol.html">search_tol</a></span><span class="op">(</span>genes<span class="op">=</span><span class="cn">TRUE</span>, limit<span class="op">=</span><span class="fl">500</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">genes_all</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 353 × 16</span>
<span class="co">#&gt;    alignment_file_url       average_contig_l… average_contig_l… exemplar_access…</span>
<span class="co">#&gt;    &lt;chr&gt;                                &lt;dbl&gt;             &lt;dbl&gt; &lt;chr&gt;           </span>
<span class="co">#&gt;  1 http://sftp.kew.org/pub…              493.              86.3 Q8GWR1          </span>
<span class="co">#&gt;  2 http://sftp.kew.org/pub…              584.              51.7 Q8H1R4          </span>
<span class="co">#&gt;  3 http://sftp.kew.org/pub…              453.              55.2 Q8LEF6          </span>
<span class="co">#&gt;  4 http://sftp.kew.org/pub…              487.              55.1 Q9FZ49          </span>
<span class="co">#&gt;  5 http://sftp.kew.org/pub…              645.              60.8 P04747          </span>
<span class="co">#&gt;  6 http://sftp.kew.org/pub…              790.              68.4 Q9ZUC1          </span>
<span class="co">#&gt;  7 http://sftp.kew.org/pub…              641.              53.6 Q8VY89          </span>
<span class="co">#&gt;  8 http://sftp.kew.org/pub…              969.              65.2 Q9LRZ3          </span>
<span class="co">#&gt;  9 http://sftp.kew.org/pub…              344.              67.4 Q9FIG9          </span>
<span class="co">#&gt; 10 http://sftp.kew.org/pub…              612.              90.4 F4JUL9          </span>
<span class="co">#&gt; # … with 343 more rows, and 12 more variables: exemplar_hyperlink &lt;chr&gt;,</span>
<span class="co">#&gt; #   exemplar_name &lt;chr&gt;, exemplar_species &lt;chr&gt;, fasta_file_url &lt;chr&gt;,</span>
<span class="co">#&gt; #   genera_count &lt;int&gt;, id &lt;int&gt;, internal_name &lt;chr&gt;, newick_file &lt;chr&gt;,</span>
<span class="co">#&gt; #   newick_file_path_name &lt;chr&gt;, sequence_count &lt;int&gt;, species_count &lt;int&gt;,</span>
<span class="co">#&gt; #   tree_file_url &lt;chr&gt;</span></code></pre></div>
<p>But they cannot currently be queried, so the best bet is just to grab all of them.</p>
</div>
<div id="looking-up-a-record" class="section level2">
<h2 class="hasAnchor">
<a href="#looking-up-a-record" class="anchor"></a>Looking up a record</h2>
<p>Information about a single specimen or gene can be looked up using their ID:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">specimen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lookup_tol.html">lookup_tol</a></span><span class="op">(</span><span class="st">"2660"</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="va">specimen</span>
<span class="co">#&gt; &lt;ToL specimen id: 2660&gt;</span>
<span class="co">#&gt; Species: Acca sellowiana</span>
<span class="co">#&gt; Family: Myrtaceae</span>
<span class="co">#&gt; Order: Myrtales</span>
<span class="co">#&gt; Collector: Chase, M.W.</span>
<span class="co">#&gt; Project: PAFTOL</span>
<span class="co">#&gt; No. of reads: 2,218,140</span>
<span class="co">#&gt; Sequencing platform: MiSeq</span>
<span class="co">#&gt; Suspicious placement: FALSE</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gene</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lookup_tol.html">lookup_tol</a></span><span class="op">(</span><span class="st">"51"</span>, type<span class="op">=</span><span class="st">"gene"</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="va">gene</span>
<span class="co">#&gt; &lt;ToL gene id: 51&gt;</span>
<span class="co">#&gt; Exemplar name: AAAS</span>
<span class="co">#&gt; Exemplar source species: Arabidopsis thaliana (Mouse-ear cress)</span>
<span class="co">#&gt; No. species: 2905</span>
<span class="co">#&gt; No. genera: 2294</span>
<span class="co">#&gt; Avg. recovered length: 493.4949</span>
<span class="co">#&gt; Avg. % recovered: 86.3</span></code></pre></div>
</div>
<div id="loading-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-data" class="anchor"></a>Loading data</h2>
<p>Records returned by <code>search_tol</code> and <code>lookup_tol</code> contain links to data files on an SFTP server. You can load these into R using the <code>load_tol</code> function. As you saw at the top of this vignette, if you don’t provide any URL to <code>load_tol</code>, it will load the whole Tree of Life tree file.</p>
<p>To load a sequence file for a particular specimen:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/load_tol.html">load_tol</a></span><span class="op">(</span><span class="va">specimen</span><span class="op">$</span><span class="va">fasta_file_url</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="co">#&gt; &lt;ToL fasta url: http://sftp.kew.org/pub/paftol/current_release/fasta/by_recovery/INSDC.ERR5033686.Acca_sellowiana.a353.fasta&gt;</span>
<span class="co">#&gt; Preview:</span>
<span class="co">#&gt; &gt;6483 Gene_Name:RPL13 Species:Acca_sellowiana Repository:INSDC Sequence_ID:ERR5033686</span>
<span class="co">#&gt; GGACAGTTAGTTGT</span></code></pre></div>
<p>To load a sequence file for a gene:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/load_tol.html">load_tol</a></span><span class="op">(</span><span class="va">gene</span><span class="op">$</span><span class="va">fasta_file_url</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="co">#&gt; &lt;ToL fasta url: http://sftp.kew.org/pub/paftol/current_release/fasta/by_gene/5328.dna.fasta&gt;</span>
<span class="co">#&gt; Preview:</span>
<span class="co">#&gt; &gt;5328 Gene_Name:AAAS Species:Thaumatococcus_daniellii Repository:INSDC Sequence_ID:ERR5034476</span>
<span class="co">#&gt; GAGCGG</span></code></pre></div>
<p>Or the alignment file:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/load_tol.html">load_tol</a></span><span class="op">(</span><span class="va">gene</span><span class="op">$</span><span class="va">alignment_file_url</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="co">#&gt; &lt;ToL fasta url: http://sftp.kew.org/pub/paftol/current_release/fasta/alignments/5328.dna.aln.fasta&gt;</span>
<span class="co">#&gt; Preview:</span>
<span class="co">#&gt; &gt;5328 Gene_Name:AAAS Species:Ceratophyllum_demersum Repository:INSDC Sequence_ID:SRR7451107</span>
<span class="co">#&gt; --------</span></code></pre></div>
<p>Or the gene tree:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/load_tol.html">load_tol</a></span><span class="op">(</span><span class="va">gene</span><span class="op">$</span><span class="va">tree_file_url</span><span class="op">)</span>
<span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span>
<span class="co">#&gt; &lt;ToL tree url: http://sftp.kew.org/pub/paftol/current_release/tree/gene/5328.tree&gt;</span>
<span class="co">#&gt; Preview:</span>
<span class="co">#&gt; (Ceratophyllales_Ceratophyllaceae_Ceratophyllum_demersum_SRR7451107:0.3494554101,(((((((((((((((((((</span></code></pre></div>
<p>All files are returned as strings, so you will need to parse them to use them downstream.</p>
<p>If you want to download these files directly, you can use the <code>download_tol</code> function.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Barnaby Walker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
